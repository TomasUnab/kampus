<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kampus - Planes</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

<!-- Sistemas KAMPUS -->
<script src="../js/session-manager.js"></script>
<script src="../js/cache-manager.js"></script>
<script src="../js/performance-optimizer.js"></script>
<script src="../js/notification-system.js"></script>
<script src="../js/moderation-system.js"></script>
<script src="../js/kampus-init.js"></script>
<script src="../js/header-sync.js"></script>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link rel="stylesheet" href="../css/mobile-fixes.css">
<link rel="stylesheet" href="../css/mobile-layout-fixes.css">
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#13a4ec",
            "background-light": "#f6f7f8",
            "background-dark": "#101c22",
          },
          fontFamily: {
            "display": ["Plus Jakarta Sans"]
          },
        },
      },
    }
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="min-h-screen flex flex-col">
<!-- Header -->
<header class="sticky top-0 z-20 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-b border-black/10 dark:border-white/10">
<div class="container mx-auto px-4 sm:px-6">
<div class="flex items-center justify-between sm:justify-center h-16 gap-4 sm:gap-12">
<a class="flex items-center gap-3 text-gray-800 dark:text-white" href="../dashboard_principal/code.html">
<svg class="h-6 w-6 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M44 11.2727C44 14.0109 39.8386 16.3957 33.69 17.6364C39.8386 18.877 44 21.2618 44 24C44 26.7382 39.8386 29.123 33.69 30.3636C39.8386 31.6043 44 33.9891 44 36.7273C44 40.7439 35.0457 44 24 44C12.9543 44 4 40.7439 4 36.7273C4 33.9891 8.16144 31.6043 14.31 30.3636C8.16144 29.123 4 26.7382 4 24C4 21.2618 8.16144 18.877 14.31 17.6364C8.16144 16.3957 4 14.0109 4 11.2727C4 7.25611 12.9543 4 24 4C35.0457 4 44 7.25611 44 11.2727Z" fill="currentColor"></path></svg>
<h1 class="text-xl font-bold">Kampus</h1>
</a>
<!-- Bot√≥n men√∫ m√≥vil -->
<button class="md:hidden p-2 text-gray-600 dark:text-gray-300" onclick="toggleMobileMenu()">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>

<nav class="hidden md:flex items-center gap-6">
<a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary transition-colors" href="../dashboard_principal/code.html">Inicio</a>
<a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary transition-colors" href="../resultados_de_b√∫squeda/code.html">Explorar</a>
<a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary transition-colors" href="../mis_materiales/code.html">Mis materiales</a>
<a class="text-sm font-medium text-primary" href="code.html">Planes</a>
</nav>

<!-- Men√∫ m√≥vil -->
<div id="mobile-menu" class="hidden fixed top-16 left-0 right-0 bg-white dark:bg-background-dark border-t border-gray-200 dark:border-gray-700 md:hidden z-50 shadow-lg">
<div class="px-4 py-4 space-y-2">
<a class="block px-4 py-3 text-gray-600 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" href="../dashboard_principal/code.html">üè† Inicio</a>
<a class="block px-4 py-3 text-gray-600 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" href="../resultados_de_b√∫squeda/code.html">üîç Explorar</a>
<a class="block px-4 py-3 text-gray-600 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" href="../mis_materiales/code.html">üìö Mis materiales</a>
<a class="block px-4 py-3 text-primary bg-primary/10 rounded-lg" href="code.html">üíé Planes</a>
</div>
</div>

<div class="flex items-center gap-4">
<div data-header-avatar class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 cursor-pointer" onclick="window.location.href='../perfil_de_usuario/code.html'" style='background-image: url("https://i.pravatar.cc/150?img=9");'></div>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main class="flex-grow container mx-auto px-4 sm:px-6 py-8 sm:py-16">
<!-- Hero Section -->
<div class="text-center mb-8 sm:mb-16">
<h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-4">Elige el plan perfecto para ti</h1>
<p class="text-lg sm:text-xl text-gray-600 dark:text-gray-400 px-4">Accede a miles de materiales de estudio y potencia tu aprendizaje</p>
</div>

<!-- Pricing Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 max-w-5xl mx-auto">
<!-- Plan Gratuito -->
<div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border-2 border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow">
<div class="text-center mb-6">
<h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Plan Gratuito</h2>
<div class="flex items-baseline justify-center gap-2 mb-4">
<span class="text-5xl font-bold text-gray-900 dark:text-white">$0</span>
<span class="text-gray-600 dark:text-gray-400">/mes</span>
</div>
<p class="text-gray-600 dark:text-gray-400">Perfecto para empezar</p>
</div>

<ul class="space-y-4 mb-8">
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-green-500 mt-0.5">check_circle</span>
<span class="text-gray-700 dark:text-gray-300"><strong>Descargas ilimitadas</strong> de materiales</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-green-500 mt-0.5">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Subida de hasta <strong>5 archivos/mes</strong></span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-green-500 mt-0.5">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Hasta <strong>50 materiales favoritos</strong></span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-green-500 mt-0.5">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">B√∫squeda y filtros b√°sicos</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-green-500 mt-0.5">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Sistema de calificaciones</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-red-500 mt-0.5">cancel</span>
<span class="text-gray-400 dark:text-gray-500 line-through">Res√∫menes por IA</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-red-500 mt-0.5">cancel</span>
<span class="text-gray-400 dark:text-gray-500 line-through">Estad√≠sticas avanzadas</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-red-500 mt-0.5">cancel</span>
<span class="text-gray-400 dark:text-gray-500 line-through">Alertas personalizadas</span>
</li>
</ul>

<button id="btn-plan-actual" class="w-full py-3 px-6 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
Tu plan actual
</button>
</div>

<!-- Plan Premium -->
<div class="bg-gradient-to-br from-primary via-blue-500 to-blue-600 rounded-2xl p-8 shadow-2xl border-2 border-primary hover:shadow-3xl transition-shadow relative overflow-hidden">
<div class="absolute top-4 right-4">
<span class="bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full">RECOMENDADO</span>
</div>

<div class="text-center mb-6">
<h2 class="text-2xl font-bold text-white mb-2">Plan Premium</h2>
<div class="flex items-baseline justify-center gap-2 mb-4">
<span class="text-5xl font-bold text-white">$4.990</span>
<span class="text-white/80">/mes</span>
</div>
<p class="text-white/90">Para estudiantes serios</p>
</div>

<ul class="space-y-4 mb-8">
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white"><strong>Todo lo del plan gratuito</strong></span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white"><strong>Subida ilimitada</strong> de archivos</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white"><strong>Favoritos ilimitados</strong></span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white">üß† <strong>Res√∫menes autom√°ticos por IA</strong></span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white">üìä <strong>Estad√≠sticas detalladas</strong> de uso</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white">üîî <strong>Alertas personalizadas</strong> por ramo</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white">‚ö° <strong>Acceso prioritario</strong> a nuevos materiales</span>
</li>
<li class="flex items-start gap-3">
<span class="material-symbols-outlined text-yellow-300 mt-0.5">check_circle</span>
<span class="text-white">üé® <strong>Badge Premium</strong> en tu perfil</span>
</li>
</ul>

<button id="btn-mejorar-premium" class="w-full py-3 px-6 rounded-lg bg-white text-primary font-bold hover:bg-gray-100 transition-colors shadow-lg">
Mejorar a Premium
</button>

<p class="text-center text-white/80 text-sm mt-4">Cancela cuando quieras. Sin compromisos.</p>
</div>
</div>

<!-- FAQ Section -->
<div class="mt-20 max-w-3xl mx-auto">
<h2 class="text-3xl font-bold text-gray-900 dark:text-white text-center mb-10">Preguntas frecuentes</h2>
<div class="space-y-4">
<details class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
<summary class="font-bold text-gray-900 dark:text-white cursor-pointer">¬øPuedo cancelar mi suscripci√≥n Premium en cualquier momento?</summary>
<p class="mt-3 text-gray-600 dark:text-gray-400">S√≠, puedes cancelar tu suscripci√≥n en cualquier momento desde tu perfil. No hay penalizaciones ni cargos ocultos.</p>
</details>
<details class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
<summary class="font-bold text-gray-900 dark:text-white cursor-pointer">¬øQu√© sucede con mis materiales si cancelo Premium?</summary>
<p class="mt-3 text-gray-600 dark:text-gray-400">Todos tus materiales subidos permanecer√°n en la plataforma. Solo perder√°s acceso a las funciones Premium como los res√∫menes por IA y estad√≠sticas avanzadas.</p>
</details>
<details class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
<summary class="font-bold text-gray-900 dark:text-white cursor-pointer">¬øHay descuentos para estudiantes?</summary>
<p class="mt-3 text-gray-600 dark:text-gray-400">Kampus est√° dise√±ado espec√≠ficamente para estudiantes universitarios. El precio Premium ya est√° optimizado para el presupuesto estudiantil.</p>
</details>
<details class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
<summary class="font-bold text-gray-900 dark:text-white cursor-pointer">¬øC√≥mo funcionan los res√∫menes por IA?</summary>
<p class="mt-3 text-gray-600 dark:text-gray-400">Nuestra IA analiza el contenido de cada material y genera un resumen conciso con los puntos clave, nivel de dificultad y tiempo estimado de estudio.</p>
</details>
</div>
</div>
</main>

<!-- Footer -->
<footer class="bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 py-8 mt-16">
<div class="container mx-auto px-6 text-center">
<p class="text-gray-600 dark:text-gray-400 text-sm">¬© 2025 Kampus. Hecho con ‚ù§Ô∏è para estudiantes chilenos.</p>
</div>
</footer>
</div>

<!-- Modal Mejorar a Premium -->
<div id="modal-premium" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 transform transition-all">
<div class="text-center">
<div class="mx-auto w-16 h-16 bg-gradient-to-br from-primary via-blue-500 to-blue-600 rounded-full flex items-center justify-center mb-4">
<span class="material-symbols-outlined text-white text-4xl">workspace_premium</span>
</div>
<h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">¬°Actualiza a Premium!</h3>
<p class="text-gray-600 dark:text-gray-400 mb-6">Desbloquea todas las funcionalidades y mejora tu experiencia de estudio</p>
          
<div class="space-y-3 mb-6">
<div class="flex items-center gap-3 text-left">
<span class="material-symbols-outlined text-primary">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Descargas ilimitadas</span>
</div>
<div class="flex items-center gap-3 text-left">
<span class="material-symbols-outlined text-primary">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Res√∫menes por IA</span>
</div>
<div class="flex items-center gap-3 text-left">
<span class="material-symbols-outlined text-primary">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Sin anuncios</span>
</div>
<div class="flex items-center gap-3 text-left">
<span class="material-symbols-outlined text-primary">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Badge Premium en tu perfil</span>
</div>
</div>

<div class="bg-primary/10 dark:bg-primary/20 rounded-lg p-4 mb-6">
<p class="text-3xl font-bold text-primary mb-1">$4.990 <span class="text-base font-normal text-gray-600 dark:text-gray-400">/mes</span></p>
<p class="text-sm text-gray-600 dark:text-gray-400">Cancela cuando quieras</p>
</div>

<div class="flex gap-3">
<button id="btn-cancelar-modal" class="flex-1 py-3 px-6 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
Cancelar
</button>
<button id="btn-confirmar-premium" class="flex-1 py-3 px-6 rounded-lg bg-gradient-to-r from-primary to-blue-600 text-white font-bold hover:from-primary/90 hover:to-blue-600/90 transition-all shadow-lg">
Continuar
</button>
</div>
</div>
</div>
</div>

<!-- Modal Plan Actual (Freemium) -->
<div id="modal-plan-actual" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 transform transition-all">
<div class="text-center">
<div class="mx-auto w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4">
<span class="material-symbols-outlined text-gray-600 dark:text-gray-300 text-4xl">person</span>
</div>
<h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Plan Freemium</h3>
<p class="text-gray-600 dark:text-gray-400 mb-6">Tu plan actual - Gratis para siempre</p>
          
<div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-6">
<p class="text-4xl font-bold text-gray-900 dark:text-white mb-1">$0 <span class="text-base font-normal text-gray-600 dark:text-gray-400">/mes</span></p>
<p class="text-sm text-gray-600 dark:text-gray-400">Sin costo, sin tarjeta</p>
</div>

<div class="text-left space-y-3 mb-6">
<h4 class="font-semibold text-gray-900 dark:text-white mb-3">Lo que incluye tu plan:</h4>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-green-500">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">5 descargas al mes</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-green-500">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Acceso a materiales b√°sicos</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-green-500">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">Subir hasta 10 archivos</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-green-500">check_circle</span>
<span class="text-gray-700 dark:text-gray-300">B√∫squeda b√°sica</span>
</div>
</div>

<div class="border-t border-gray-200 dark:border-gray-600 pt-4 mb-6">
<h4 class="font-semibold text-gray-900 dark:text-white mb-3 text-left">¬øQuieres m√°s?</h4>
<div class="text-left space-y-2">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary text-xl">upgrade</span>
<span class="text-sm text-gray-600 dark:text-gray-400">Descargas ilimitadas</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary text-xl">upgrade</span>
<span class="text-sm text-gray-600 dark:text-gray-400">Res√∫menes por IA</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary text-xl">upgrade</span>
<span class="text-sm text-gray-600 dark:text-gray-400">Sin anuncios</span>
</div>
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary text-xl">upgrade</span>
<span class="text-sm text-gray-600 dark:text-gray-400">Acceso prioritario</span>
</div>
</div>
</div>

<div class="flex gap-3">
<button id="btn-cerrar-plan-actual" class="flex-1 py-3 px-6 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
Cerrar
</button>
<button id="btn-upgrade-desde-actual" class="flex-1 py-3 px-6 rounded-lg bg-gradient-to-r from-primary to-blue-600 text-white font-bold hover:from-primary/90 hover:to-blue-600/90 transition-all shadow-lg">
Mejorar Plan
</button>
</div>
</div>
</div>
</div>

<!-- Modal Webpay (Transbank Original) -->
<div id="modal-webpay" class="hidden fixed inset-0 bg-white z-50 overflow-y-auto">
<div class="min-h-screen">
<div class="bg-white w-full overflow-hidden">
<!-- Header Webpay - Estilo oficial Transbank -->
<div class="bg-[#c41230] px-4 py-3 border-b border-[#a00f28]">
<div class="flex items-center justify-between max-w-6xl mx-auto">
<div class="flex items-center gap-3">
<div class="bg-white rounded px-3 py-1">
<span class="text-[#c41230] font-bold text-xl">Webpay</span>
</div>
<div class="text-white text-xs">
<div class="font-medium">Transbank S.A.</div>
<div class="opacity-90">Medio de pago seguro</div>
</div>
</div>
<button id="btn-cerrar-webpay" class="text-white hover:text-gray-200 text-xl font-bold">
‚úï
</button>
</div>
</div>

<!-- Informaci√≥n de la compra -->
<div class="bg-gray-50 border-b border-gray-300">
<div class="max-w-6xl mx-auto px-4 py-4">
<div class="bg-white border border-gray-300 rounded">
<div class="bg-gray-100 border-b border-gray-300 px-3 py-2">
<h3 class="text-sm font-bold text-gray-800">Informaci√≥n de la Transacci√≥n</h3>
</div>
<div class="p-4">
<table class="w-full text-sm">
<tr class="border-b border-gray-200">
<td class="py-2 font-medium text-gray-700">Comercio:</td>
<td class="py-2 text-gray-900">Kampus SpA</td>
</tr>
<tr class="border-b border-gray-200">
<td class="py-2 font-medium text-gray-700">RUT:</td>
<td class="py-2 text-gray-900">77.123.456-7</td>
</tr>
<tr class="border-b border-gray-200">
<td class="py-2 font-medium text-gray-700">Orden de Compra:</td>
<td class="py-2 text-gray-900" id="order-number">#KMP-2025-001</td>
</tr>
<tr class="border-b border-gray-200">
<td class="py-2 font-medium text-gray-700">Fecha y Hora:</td>
<td class="py-2 text-gray-900">10/01/2025 - 14:30:25</td>
</tr>
<tr>
<td class="py-2 font-medium text-gray-700">Monto:</td>
<td class="py-2 text-2xl font-bold text-[#c41230]">$4.990</td>
</tr>
</table>
</div>
</div>
</div>
</div>

<!-- Formulario de Pago -->
<div class="max-w-6xl mx-auto px-4 py-6">
<div class="bg-white border border-gray-300 rounded">
<div class="bg-gray-100 border-b border-gray-300 px-3 py-2">
<h3 class="text-sm font-bold text-gray-800">Datos de la Tarjeta</h3>
</div>
<div class="p-4">
<form id="form-webpay" class="space-y-3">
<!-- N√∫mero de tarjeta -->
<div class="grid grid-cols-4 gap-2 items-center">
<label class="text-sm font-medium text-gray-700">N√∫mero de Tarjeta *</label>
<div class="col-span-3">
<input id="card-number" type="text" maxlength="19" placeholder="0000 0000 0000 0000" class="w-full px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none font-mono" required>
<p class="text-xs text-gray-500 mt-1">Prueba: 4111 1111 1111 1111</p>
</div>
</div>

<!-- Nombre en la tarjeta -->
<div class="grid grid-cols-4 gap-2 items-center">
<label class="text-sm font-medium text-gray-700">Nombre del Titular *</label>
<div class="col-span-3">
<input id="card-name" type="text" placeholder="JUAN P√âREZ" class="w-full px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none uppercase" required>
</div>
</div>

<!-- Fecha y CVV -->
<div class="grid grid-cols-4 gap-2 items-center">
<label class="text-sm font-medium text-gray-700">Vencimiento *</label>
<input id="card-expiry" type="text" maxlength="5" placeholder="MM/AA" class="px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none font-mono text-center" required>
<label class="text-sm font-medium text-gray-700 text-right">CVV *</label>
<input id="card-cvv" type="text" maxlength="4" placeholder="123" class="px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none font-mono text-center" required>
</div>



<!-- Tipo de cuotas -->
<div class="grid grid-cols-4 gap-2 items-center">
<label class="text-sm font-medium text-gray-700">Tipo de Pago *</label>
<div class="col-span-3">
<select id="card-installments" class="w-full px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none bg-white">
<option value="VN">Venta Normal - $4.990</option>
<option value="S2">2 Cuotas sin inter√©s - 2 x $2.495</option>
<option value="SI">3 Cuotas sin inter√©s - 3 x $1.663</option>
<option value="VD">D√©bito Redcompra - $4.990</option>
</select>
</div>
</div>

<!-- Email de confirmaci√≥n -->
<div class="grid grid-cols-4 gap-2 items-center">
<label class="text-sm font-medium text-gray-700">Email *</label>
<div class="col-span-3">
<input id="card-email" type="email" placeholder="correo@ejemplo.cl" class="w-full px-3 py-2 border border-gray-300 rounded focus:border-[#c41230] focus:outline-none" required>
</div>
</div>

<!-- T√©rminos y condiciones -->
<div class="border-t border-gray-300 pt-3 mt-4">
<label class="flex items-start gap-2 cursor-pointer">
<input id="accept-terms" type="checkbox" class="mt-1" required>
<span class="text-xs text-gray-700">
Acepto los t√©rminos y condiciones del servicio Webpay y autorizo a Transbank S.A. a efectuar el cargo en mi tarjeta.
</span>
</label>
</div>

<!-- Botones -->
<div class="flex gap-2 pt-4 justify-end">
<button type="button" id="btn-cancelar-webpay" class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
Cancelar
</button>
<button type="submit" id="btn-pagar-webpay" class="px-6 py-2 bg-[#c41230] text-white rounded hover:bg-[#a00f28] font-medium">
Pagar
</button>
</div>
</form>
</div>
</div>
</div>

<!-- Footer de seguridad -->
<div class="bg-gray-100 border-t border-gray-300 p-3">
<div class="max-w-6xl mx-auto text-center">
<p class="text-xs text-gray-600">
üîí Conexi√≥n segura SSL. Tus datos est√°n protegidos por Transbank S.A.
</p>
</div>
</div>
</div>
</div>
</div>

<!-- Modal Confirmaci√≥n Exitosa -->
<div id="modal-exito" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 transform transition-all text-center">
<div class="mx-auto w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4">
<span class="material-symbols-outlined text-green-600 dark:text-green-400 text-5xl">check_circle</span>
</div>
<h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">¬°Pago Exitoso!</h3>
<p class="text-gray-600 dark:text-gray-400 mb-4">Tu transacci√≥n ha sido aprobada</p>

<div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-6 text-left">
<div class="flex justify-between mb-2">
<span class="text-sm text-gray-600 dark:text-gray-400">C√≥digo de Autorizaci√≥n:</span>
<span class="font-mono font-bold text-gray-900 dark:text-white" id="auth-code">123456</span>
</div>
<div class="flex justify-between mb-2">
<span class="text-sm text-gray-600 dark:text-gray-400">Orden de Compra:</span>
<span class="font-mono font-bold text-gray-900 dark:text-white" id="success-order-number">#KMP-2025-001</span>
</div>
<div class="flex justify-between mb-2">
<span class="text-sm text-gray-600 dark:text-gray-400">Monto:</span>
<span class="font-bold text-green-600 dark:text-green-400">$4.990</span>
</div>
<div class="flex justify-between">
<span class="text-sm text-gray-600 dark:text-gray-400">Fecha:</span>
<span class="text-sm text-gray-900 dark:text-white" id="payment-date">10/10/2025 14:30</span>
</div>
</div>

<div class="bg-gradient-to-r from-primary to-blue-600 rounded-lg p-4 mb-6">
<p class="text-white font-bold text-lg mb-1">üéâ ¬°Bienvenido a Premium!</p>
<p class="text-white/90 text-sm">Ya puedes disfrutar de todos los beneficios</p>
</div>

<button id="btn-cerrar-exito" class="w-full py-3 px-6 rounded-lg bg-gradient-to-r from-primary to-blue-600 text-white font-bold hover:from-primary/90 hover:to-blue-600/90 transition-all shadow-lg">
Continuar
</button>

<p class="text-xs text-gray-500 dark:text-gray-400 mt-4">Se ha enviado un comprobante a tu correo electr√≥nico</p>
</div>
</div>

<script>
  // Bot√≥n Mejorar a Premium
  const btnMejorarPremium = document.getElementById('btn-mejorar-premium');
  const modalPremium = document.getElementById('modal-premium');
  const btnCancelarModal = document.getElementById('btn-cancelar-modal');
  const btnConfirmarPremium = document.getElementById('btn-confirmar-premium');

  // Abrir modal
  btnMejorarPremium.addEventListener('click', () => {
    modalPremium.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  // Cerrar modal
  btnCancelarModal.addEventListener('click', () => {
    modalPremium.classList.add('hidden');
    document.body.style.overflow = 'auto';
  });

  // Cerrar modal al hacer click fuera
  modalPremium.addEventListener('click', (e) => {
    if (e.target === modalPremium) {
      modalPremium.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  });

  // Confirmar mejora a Premium (simulaci√≥n)
  btnConfirmarPremium.addEventListener('click', () => {
    // Abrir Webpay en lugar de alert
    modalPremium.classList.add('hidden');
    modalWebpay.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  // Bot√≥n Plan Actual (Freemium)
  const btnPlanActual = document.getElementById('btn-plan-actual');
  const modalPlanActual = document.getElementById('modal-plan-actual');
  const btnCerrarPlanActual = document.getElementById('btn-cerrar-plan-actual');
  const btnUpgradeDesdeActual = document.getElementById('btn-upgrade-desde-actual');

  // Abrir modal plan actual
  btnPlanActual.addEventListener('click', () => {
    modalPlanActual.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  // Cerrar modal plan actual
  btnCerrarPlanActual.addEventListener('click', () => {
    modalPlanActual.classList.add('hidden');
    document.body.style.overflow = 'auto';
  });

  // Cerrar modal al hacer click fuera
  modalPlanActual.addEventListener('click', (e) => {
    if (e.target === modalPlanActual) {
      modalPlanActual.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  });

  // Mejorar plan desde modal actual (abre modal Premium)
  btnUpgradeDesdeActual.addEventListener('click', () => {
    modalPlanActual.classList.add('hidden');
    modalPremium.classList.remove('hidden');
  });

  // === WEBPAY (TRANSBANK SIMULADO) ===
  const modalWebpay = document.getElementById('modal-webpay');
  const modalExito = document.getElementById('modal-exito');
  const formWebpay = document.getElementById('form-webpay');
  const btnCerrarWebpay = document.getElementById('btn-cerrar-webpay');
  const btnCancelarWebpay = document.getElementById('btn-cancelar-webpay');
  const btnCerrarExito = document.getElementById('btn-cerrar-exito');
  
  // Inputs de tarjeta
  const cardNumber = document.getElementById('card-number');
  const cardExpiry = document.getElementById('card-expiry');
  const cardCvv = document.getElementById('card-cvv');
  const cardName = document.getElementById('card-name');
  const cardRut = document.getElementById('card-rut');
  const acceptTerms = document.getElementById('accept-terms');

  // C√≥digos de respuesta Transbank (Nivel 2)
  const TRANSBANK_CODES = {
    '-1': 'Tarjeta inv√°lida',
    '-2': 'Error de conexi√≥n',
    '-3': 'Excede monto m√°ximo',
    '-4': 'Fecha de expiraci√≥n inv√°lida',
    '-5': 'Problema en autenticaci√≥n',
    '-6': 'Rechazo general',
    '-7': 'Tarjeta bloqueada',
    '-8': 'Tarjeta vencida',
    '-9': 'Transacci√≥n no soportada',
    '-10': 'Problema en la transacci√≥n',
    '-11': 'Excede l√≠mite de reintentos de rechazos'
  };

  // Validar algoritmo de Luhn (validaci√≥n de tarjetas)
  function validarLuhn(numero) {
    let sum = 0;
    let shouldDouble = false;
    for (let i = numero.length - 1; i >= 0; i--) {
      let digit = parseInt(numero.charAt(i));
      if (shouldDouble) {
        digit *= 2;
        if (digit > 9) digit -= 9;
      }
      sum += digit;
      shouldDouble = !shouldDouble;
    }
    return (sum % 10) === 0;
  }

  // Detectar tipo de tarjeta
  function detectarTipoTarjeta(numero) {
    numero = numero.replace(/\s/g, '');
    if (/^4/.test(numero)) return { tipo: 'Visa', icono: 'üí≥' };
    if (/^5[1-5]/.test(numero)) return { tipo: 'Mastercard', icono: 'üí≥' };
    if (/^3[47]/.test(numero)) return { tipo: 'American Express', icono: 'üí≥' };
    if (/^6(?:011|5)/.test(numero)) return { tipo: 'Discover', icono: 'üí≥' };
    return { tipo: 'Desconocida', icono: 'üí≥' };
  }

  // Validar RUT chileno (opcional)
  function validarRUT(rut) {
    if (!rut) return true; // RUT es opcional
    rut = rut.replace(/\./g, '').replace(/-/g, '');
    const cuerpo = rut.slice(0, -1);
    const dv = rut.slice(-1).toUpperCase();
    
    let suma = 0;
    let multiplo = 2;
    for (let i = cuerpo.length - 1; i >= 0; i--) {
      suma += multiplo * parseInt(cuerpo.charAt(i));
      multiplo = multiplo < 7 ? multiplo + 1 : 2;
    }
    const dvEsperado = 11 - (suma % 11);
    const dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : String(dvEsperado);
    
    return dv === dvCalculado;
  }

  // Formatear n√∫mero de tarjeta (agregar espacios cada 4 d√≠gitos)
  cardNumber.addEventListener('input', (e) => {
    let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
    e.target.value = formattedValue;
    
    // Cambiar color del borde si es v√°lido
    if (value.length >= 13) {
      const isValid = validarLuhn(value);
      e.target.classList.toggle('border-green-500', isValid);
      e.target.classList.toggle('border-red-500', !isValid);
    } else {
      e.target.classList.remove('border-green-500', 'border-red-500');
    }
  });

  // Formatear fecha de expiraci√≥n (MM/AA)
  cardExpiry.addEventListener('input', (e) => {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 2) {
      value = value.slice(0, 2) + '/' + value.slice(2, 4);
    }
    e.target.value = value;
    
    // Validar fecha
    if (value.length === 5) {
      const [mes, anio] = value.split('/').map(Number);
      const now = new Date();
      const currentYear = now.getFullYear() % 100;
      const currentMonth = now.getMonth() + 1;
      
      const isValid = mes >= 1 && mes <= 12 && 
                     (anio > currentYear || (anio === currentYear && mes >= currentMonth));
      
      e.target.classList.toggle('border-green-500', isValid);
      e.target.classList.toggle('border-red-500', !isValid);
    } else {
      e.target.classList.remove('border-green-500', 'border-red-500');
    }
  });

  // Solo n√∫meros en CVV (3 o 4 d√≠gitos seg√∫n tarjeta)
  cardCvv.addEventListener('input', (e) => {
    const cardNum = cardNumber.value.replace(/\s/g, '');
    const isAmex = /^3[47]/.test(cardNum);
    e.target.maxLength = isAmex ? 4 : 3;
    e.target.value = e.target.value.replace(/\D/g, '');
  });

  // Convertir nombre a may√∫sculas
  cardName.addEventListener('input', (e) => {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z\s]/g, '');
  });

  // Formatear RUT
  if (cardRut) {
    cardRut.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\./g, '').replace(/-/g, '').replace(/[^0-9kK]/g, '');
      if (value.length > 1) {
        value = value.slice(0, -1).replace(/\B(?=(\d{3})+(?!\d))/g, '.') + '-' + value.slice(-1);
      }
      e.target.value = value.toUpperCase();
      
      // Validar RUT
      if (value.length >= 3) {
        const isValid = validarRUT(value);
        e.target.classList.toggle('border-green-500', isValid);
        e.target.classList.toggle('border-red-500', !isValid);
      } else {
        e.target.classList.remove('border-green-500', 'border-red-500');
      }
    });
  }

  // Cerrar Webpay
  btnCerrarWebpay.addEventListener('click', () => {
    if (confirm('¬øDeseas salir de Webpay y cancelar la transacci√≥n?')) {
      modalWebpay.classList.add('hidden');
      document.body.style.overflow = 'auto';
      formWebpay.reset();
    }
  });

  btnCancelarWebpay.addEventListener('click', () => {
    if (confirm('¬øEst√°s seguro de cancelar esta transacci√≥n?\n\nSe cerrar√° la ventana de pago y deber√°s iniciar el proceso nuevamente.')) {
      modalWebpay.classList.add('hidden');
      document.body.style.overflow = 'auto';
      formWebpay.reset();
    }
  });

  // Procesar pago (simulaci√≥n mejorada)
  formWebpay.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const cardNum = cardNumber.value.replace(/\s/g, '');
    const expiry = cardExpiry.value;
    const cvv = cardCvv.value;
    const name = cardName.value;
    const rut = cardRut ? cardRut.value : '';
    const email = document.getElementById('card-email').value;
    const installments = document.getElementById('card-installments').value;

    // === VALIDACIONES EXHAUSTIVAS ===
    
    // 1. Validar n√∫mero de tarjeta
    if (cardNum.length < 13 || cardNum.length > 19) {
      mostrarError('N√∫mero de tarjeta inv√°lido', '-1');
      return;
    }

    if (!validarLuhn(cardNum)) {
      mostrarError('El n√∫mero de tarjeta no es v√°lido (checksum incorrecto)', '-1');
      return;
    }

    // 2. Validar fecha de expiraci√≥n
    if (expiry.length !== 5) {
      mostrarError('Fecha de expiraci√≥n inv√°lida', '-4');
      return;
    }

    const [mes, anio] = expiry.split('/').map(Number);
    const now = new Date();
    const currentYear = now.getFullYear() % 100;
    const currentMonth = now.getMonth() + 1;
    
    if (mes < 1 || mes > 12) {
      mostrarError('Mes de expiraci√≥n inv√°lido', '-4');
      return;
    }

    if (anio < currentYear || (anio === currentYear && mes < currentMonth)) {
      mostrarError('Tarjeta vencida', '-8');
      return;
    }

    // 3. Validar CVV
    const tipoTarjeta = detectarTipoTarjeta(cardNum);
    const cvvLength = tipoTarjeta.tipo === 'American Express' ? 4 : 3;
    if (cvv.length !== cvvLength) {
      mostrarError(`CVV debe tener ${cvvLength} d√≠gitos para ${tipoTarjeta.tipo}`, '-1');
      return;
    }

    // 4. Validar nombre
    if (!name || name.length < 3) {
      mostrarError('Debe ingresar el nombre del titular de la tarjeta', '-1');
      return;
    }

    // 5. Validar RUT (si se ingres√≥)
    if (rut && !validarRUT(rut)) {
      mostrarError('RUT inv√°lido', '-1');
      return;
    }

    // 6. Validar t√©rminos y condiciones
    if (!acceptTerms.checked) {
      mostrarError('Debe aceptar los t√©rminos y condiciones para continuar', '-6');
      return;
    }

    // 7. Validar email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      mostrarError('Email inv√°lido', '-1');
      return;
    }

    // === PROCESAMIENTO ===
    
    // Mostrar estado de procesamiento
    const btnPagar = document.getElementById('btn-pagar-webpay');
    const originalText = btnPagar.innerHTML;
    btnPagar.disabled = true;
    btnPagar.classList.add('opacity-50', 'cursor-not-allowed');
    btnPagar.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> <span>Procesando transacci√≥n...</span>';

    // Agregar indicador visual en el formulario
    const processingDiv = document.createElement('div');
    processingDiv.className = 'fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-10';
    processingDiv.innerHTML = `
      <div class="bg-white rounded-lg p-6 shadow-2xl text-center max-w-sm">
        <span class="material-symbols-outlined text-[#c41230] text-5xl animate-pulse">credit_card</span>
        <p class="text-lg font-bold text-gray-900 mt-4">Procesando pago</p>
        <p class="text-sm text-gray-500 mt-2">Conectando con Transbank...</p>
        <div class="mt-4 flex justify-center gap-1">
          <div class="w-2 h-2 bg-[#c41230] rounded-full animate-bounce" style="animation-delay: 0s"></div>
          <div class="w-2 h-2 bg-[#c41230] rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
          <div class="w-2 h-2 bg-[#c41230] rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
        </div>
      </div>
    `;
    document.body.appendChild(processingDiv);

    // Simular procesamiento con delay realista (2-3 segundos)
    setTimeout(() => {
      // Remover indicador de procesamiento
      processingDiv.remove();
      btnPagar.disabled = false;
      btnPagar.classList.remove('opacity-50', 'cursor-not-allowed');
      btnPagar.innerHTML = originalText;

      // Tarjetas de prueba v√°lidas
      const tarjetasValidas = [
        '4111111111111111', // Visa
        '5555555555554444', // Mastercard
        '378282246310005',  // Amex
        '6011111111111117'  // Discover
      ];

      // Validar tarjeta de prueba
      if (tarjetasValidas.includes(cardNum)) {
        // === PAGO EXITOSO ===
        procesarPagoExitoso(installments, name, email, tipoTarjeta);
      } else {
        // === PAGO RECHAZADO ===
        // Simular diferentes tipos de rechazo basado en el n√∫mero
        let errorCode = '-6'; // Rechazo general por defecto
        let errorMsg = 'Transacci√≥n rechazada por el emisor';
        
        // Simular diferentes rechazos seg√∫n √∫ltimo d√≠gito
        const ultimoDigito = parseInt(cardNum.slice(-1));
        if (ultimoDigito === 0) {
          errorCode = '-7';
          errorMsg = 'Tarjeta bloqueada - Contacte a su banco';
        } else if (ultimoDigito === 1) {
          errorCode = '-3';
          errorMsg = 'Excede monto m√°ximo permitido';
        } else if (ultimoDigito === 2) {
          errorCode = '-5';
          errorMsg = 'Error en autenticaci√≥n 3D-Secure';
        }
        
        mostrarError(errorMsg, errorCode, true);
      }
    }, 2500);
  });

  // Funci√≥n para mostrar errores con c√≥digos Transbank
  function mostrarError(mensaje, codigo, mostrarTarjetasPrueba = false) {
    let textoAdicional = '';
    if (mostrarTarjetasPrueba) {
      textoAdicional = '\n\nüìã TARJETAS DE PRUEBA V√ÅLIDAS:\n' +
                       '‚Ä¢ Visa: 4111 1111 1111 1111\n' +
                       '‚Ä¢ Mastercard: 5555 5555 5555 4444\n' +
                       '‚Ä¢ Amex: 3782 822463 10005\n\n' +
                       'Fecha: Cualquier fecha futura\n' +
                       'CVV: Cualquier 3 d√≠gitos (4 para Amex)';
    }
    
    alert(`‚ùå ERROR DE TRANSACCI√ìN\n\n` +
          `C√≥digo: ${codigo} - ${TRANSBANK_CODES[codigo] || 'Error desconocido'}\n\n` +
          `Detalle: ${mensaje}${textoAdicional}`);
  }

  // Funci√≥n para procesar pago exitoso
  function procesarPagoExitoso(installments, name, email, tipoTarjeta) {
    modalWebpay.classList.add('hidden');
    
    // Generar datos de confirmaci√≥n realistas
    const authCode = Math.floor(100000 + Math.random() * 900000);
    const orderNum = '#KMP-' + new Date().getFullYear() + '-' + String(Math.floor(Math.random() * 10000)).padStart(5, '0');
    const transactionId = 'TBK' + Math.floor(10000000000 + Math.random() * 90000000000);
    const now = new Date();
    const dateStr = now.toLocaleDateString('es-CL', { 
      day: '2-digit', 
      month: '2-digit', 
      year: 'numeric' 
    }) + ' - ' + now.toLocaleTimeString('es-CL', { 
      hour: '2-digit', 
      minute: '2-digit',
      second: '2-digit'
    });

    // Determinar tipo de pago seg√∫n c√≥digo
    let tipoPagoTexto = 'Venta Normal (VN)';
    if (installments.includes('S2')) tipoPagoTexto = '2 Cuotas sin inter√©s (S2)';
    else if (installments.includes('SI')) tipoPagoTexto = '3 Cuotas sin inter√©s (SI)';
    else if (installments.includes('NC')) tipoPagoTexto = '6 Cuotas sin inter√©s (NC)';
    else if (installments.includes('VC')) {
      if (installments.includes('3')) tipoPagoTexto = '3 Cuotas normales (VC)';
      else if (installments.includes('6')) tipoPagoTexto = '6 Cuotas normales (VC)';
      else if (installments.includes('12')) tipoPagoTexto = '12 Cuotas normales (VC)';
    } else if (installments === 'VD') tipoPagoTexto = 'D√©bito Redcompra (VD)';

    // Actualizar modal de √©xito con todos los datos
    document.getElementById('auth-code').textContent = authCode;
    document.getElementById('success-order-number').textContent = orderNum;
    document.getElementById('payment-date').textContent = dateStr;
    
    // Agregar informaci√≥n adicional si existen los elementos
    const transactionIdEl = document.getElementById('transaction-id');
    const paymentTypeEl = document.getElementById('payment-type');
    const cardTypeEl = document.getElementById('card-type');
    const emailConfirmEl = document.getElementById('email-confirm');
    
    if (transactionIdEl) transactionIdEl.textContent = transactionId;
    if (paymentTypeEl) paymentTypeEl.textContent = tipoPagoTexto;
    if (cardTypeEl) cardTypeEl.textContent = tipoTarjeta.tipo;
    if (emailConfirmEl) emailConfirmEl.textContent = email;

    // === ACTIVAR PREMIUM EN SISTEMA ===
    const premiumData = {
      active: true,
      startDate: new Date().toISOString(),
      endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 d√≠as
      plan: 'Premium Mensual',
      price: 4990,
      paymentMethod: tipoTarjeta.tipo,
      transactionId: transactionId,
      authCode: authCode,
      orderNumber: orderNum
    };
    
    // Guardar en localStorage
    localStorage.setItem('kampus_premium', JSON.stringify(premiumData));
    localStorage.setItem('kampus_premium_active', 'true');
    
    console.log('‚úÖ Premium activado:', premiumData);

    // Mostrar modal de √©xito
    modalExito.classList.remove('hidden');
    
    // Limpiar formulario
    formWebpay.reset();
    
    // Resetear colores de validaci√≥n
    cardNumber.classList.remove('border-green-500', 'border-red-500');
    cardExpiry.classList.remove('border-green-500', 'border-red-500');
    if (cardRut) cardRut.classList.remove('border-green-500', 'border-red-500');
  }

  // Cerrar modal de √©xito
  btnCerrarExito.addEventListener('click', () => {
    modalExito.classList.add('hidden');
    document.body.style.overflow = 'auto';
    
    // Redirigir a la p√°gina Premium
    setTimeout(() => {
      window.location.href = '../premium_activo/code.html';
    }, 300);
  });

  // Cerrar modal de √©xito al hacer click fuera
  modalExito.addEventListener('click', (e) => {
    if (e.target === modalExito) {
      btnCerrarExito.click();
    }
  });

  // Men√∫ m√≥vil
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    menu.classList.toggle('hidden');
  }

  // Cerrar men√∫ al hacer clic fuera
  document.addEventListener('click', (e) => {
    const menu = document.getElementById('mobile-menu');
    const button = e.target.closest('button[onclick="toggleMobileMenu()"]');
    if (!button && !menu.contains(e.target)) {
      menu.classList.add('hidden');
    }
  });
</script>

<!-- Script para detectar y marcar plan activo -->
<script>
  // Funci√≥n para verificar si el usuario tiene Premium activo
  function isPremiumActive() {
    const premiumActive = localStorage.getItem('kampus_premium_active');
    const premiumData = localStorage.getItem('kampus_premium');
    
    if (premiumActive === 'true' && premiumData) {
      const data = JSON.parse(premiumData);
      const endDate = new Date(data.endDate);
      const now = new Date();
      
      // Verificar si no ha expirado
      if (endDate > now) {
        return true;
      } else {
        // Premium expirado, limpiar
        localStorage.removeItem('kampus_premium_active');
        localStorage.removeItem('kampus_premium');
        return false;
      }
    }
    
    return false;
  }

  // Marcar el plan activo visualmente
  function markActivePlan() {
    const btnPlanGratuito = document.getElementById('btn-plan-actual');
    const btnPremium = document.getElementById('btn-mejorar-premium');
    const planGratuitoCard = btnPlanGratuito?.closest('.bg-white');
    const planPremiumCard = btnPremium?.closest('.bg-gradient-to-br');
    
    if (isPremiumActive()) {
      // Usuario tiene Premium activo
      console.log('‚úÖ Usuario Premium detectado');
      
      // Marcar tarjeta Premium como activa
      if (planPremiumCard) {
        planPremiumCard.classList.add('ring-4', 'ring-yellow-400', 'ring-offset-4', 'ring-offset-background-light', 'dark:ring-offset-background-dark');
        planPremiumCard.style.transform = 'scale(1.02)';
        planPremiumCard.style.transition = 'transform 0.3s ease';
      }
      
      // Cambiar bot√≥n Premium a "Tu plan actual"
      if (btnPremium) {
        btnPremium.textContent = 'Tu plan actual';
        btnPremium.classList.remove('bg-white', 'text-primary', 'hover:bg-gray-100');
        btnPremium.classList.add('bg-green-500', 'text-white', 'cursor-default');
        btnPremium.onclick = (e) => {
          e.preventDefault();
          window.location.href = '../premium_activo/code.html';
        };
      }
      
      // Cambiar bot√≥n Gratuito a enlace para cambiar plan
      if (btnPlanGratuito) {
        btnPlanGratuito.textContent = 'Cambiar a este plan';
        btnPlanGratuito.classList.remove('bg-gray-200', 'dark:bg-gray-700');
        btnPlanGratuito.classList.add('bg-gray-300', 'dark:bg-gray-600', 'hover:bg-gray-400', 'dark:hover:bg-gray-500');
        btnPlanGratuito.onclick = () => {
          showCancelPremiumModal();
        };
      }
      
    } else {
      // Usuario tiene plan gratuito
      console.log('‚ÑπÔ∏è Usuario con plan gratuito');
      
      // Marcar tarjeta Gratuita como activa
      if (planGratuitoCard) {
        planGratuitoCard.classList.add('ring-4', 'ring-primary', 'ring-offset-4', 'ring-offset-background-light', 'dark:ring-offset-background-dark');
        planGratuitoCard.style.transform = 'scale(1.02)';
        planGratuitoCard.style.transition = 'transform 0.3s ease';
      }
      
      // Bot√≥n gratuito ya dice "Tu plan actual" (mantener)
      if (btnPlanGratuito) {
        btnPlanGratuito.classList.add('cursor-default');
        btnPlanGratuito.onclick = (e) => e.preventDefault();
      }
      
      // Bot√≥n Premium mantiene "Mejorar a Premium" (ya configurado en el HTML)
    }
  }

  // Modal personalizado para confirmar cancelaci√≥n de Premium
  function showCancelPremiumModal() {
    // Crear modal
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn';
    modal.innerHTML = `
      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full shadow-2xl overflow-hidden animate-scaleIn">
        <!-- Header con icono de advertencia -->
        <div class="bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white">
          <div class="flex items-center gap-4">
            <div class="bg-white/20 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
                <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
              </svg>
            </div>
            <div>
              <h3 class="text-2xl font-bold">Cancelar Premium</h3>
              <p class="text-sm text-orange-100">Esta acci√≥n no se puede deshacer</p>
            </div>
          </div>
        </div>
        
        <!-- Contenido -->
        <div class="p-6">
          <p class="text-gray-700 dark:text-gray-300 mb-4">
            ¬øEst√°s seguro de que quieres cancelar tu suscripci√≥n Premium y volver al plan gratuito?
          </p>
          
          <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 mb-6">
            <h4 class="font-bold text-red-800 dark:text-red-400 mb-2 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
              </svg>
              Perder√°s acceso a:
            </h4>
            <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">
              <li>‚Ä¢ Res√∫menes autom√°ticos por IA</li>
              <li>‚Ä¢ Estad√≠sticas detalladas</li>
              <li>‚Ä¢ Subida ilimitada de archivos</li>
              <li>‚Ä¢ Alertas personalizadas</li>
              <li>‚Ä¢ Badge Premium en tu perfil</li>
            </ul>
          </div>
          
          <!-- Botones -->
          <div class="flex gap-3">
            <button id="btn-cancel-modal" class="flex-1 py-3 px-4 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              No, mantener Premium
            </button>
            <button id="btn-confirm-cancel" class="flex-1 py-3 px-4 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-bold hover:from-red-600 hover:to-red-700 transition-all shadow-lg">
              S√≠, cancelar
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Cerrar modal (mantener Premium)
    document.getElementById('btn-cancel-modal').addEventListener('click', () => {
      document.body.style.overflow = '';
      modal.remove();
    });
    
    // Cerrar al hacer clic fuera
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        document.body.style.overflow = '';
        modal.remove();
      }
    });
    
    // Confirmar cancelaci√≥n
    document.getElementById('btn-confirm-cancel').addEventListener('click', () => {
      // Cancelar Premium
      localStorage.removeItem('kampus_premium_active');
      localStorage.removeItem('kampus_premium');
      
      // Cerrar modal de confirmaci√≥n
      modal.remove();
      
      // Mostrar modal de √©xito
      showSuccessCancelModal();
    });
  }
  
  // Modal de √©xito al cancelar Premium
  function showSuccessCancelModal() {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4';
    modal.innerHTML = `
      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-gray-500 to-gray-600 p-6 text-white text-center">
          <div class="inline-flex items-center justify-center bg-white/20 rounded-full p-4 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12">
              <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
            </svg>
          </div>
          <h3 class="text-2xl font-bold mb-2">Suscripci√≥n Cancelada</h3>
          <p class="text-sm text-gray-100">Tu plan Premium ha sido cancelado</p>
        </div>
        
        <div class="p-6 text-center">
          <p class="text-gray-700 dark:text-gray-300 mb-6">
            Ahora tienes el <strong>plan gratuito</strong>. Puedes volver a Premium cuando quieras.
          </p>
          
          <button id="btn-close-success" class="w-full py-3 px-6 rounded-lg bg-primary text-white font-bold hover:bg-opacity-90 transition-all">
            Entendido
          </button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('btn-close-success').addEventListener('click', () => {
      document.body.style.overflow = '';
      modal.remove();
      location.reload();
    });
  }

  // Ejecutar cuando el DOM est√© listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', markActivePlan);
  } else {
    markActivePlan();
  }
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes scaleIn {
    from { 
      opacity: 0;
      transform: scale(0.9);
    }
    to { 
      opacity: 1;
      transform: scale(1);
    }
  }
  
  .animate-fadeIn {
    animation: fadeIn 0.2s ease-out;
  }
  
  .animate-scaleIn {
    animation: scaleIn 0.3s ease-out;
  }
</style>

<!-- Script de sincronizaci√≥n de avatar -->
<script src="../js/header-sync.js"></script>

</body>
</html>
