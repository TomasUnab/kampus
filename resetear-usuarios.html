<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resetear Usuarios - KAMPUS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Sistemas KAMPUS -->
  <script src="js/session-manager.js"></script>
  <script src="js/cache-manager.js"></script>
  <script src="js/performance-optimizer.js"></script>
  <script src="js/notification-system.js"></script>
  <script src="js/moderation-system.js"></script>
  <script src="js/kampus-init.js"></script>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen">

  <div class="max-w-2xl w-full mx-4">
    <div class="bg-white rounded-lg shadow-lg p-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">ğŸ”§ Resetear Sistema de Usuarios</h1>
      <p class="text-gray-600 mb-6">
        Esta herramienta borrarÃ¡ todos los usuarios existentes y crearÃ¡ nuevamente los usuarios de prueba con el sistema de roles actualizado.
      </p>

      <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm text-yellow-700">
              <strong>Advertencia:</strong> Esto borrarÃ¡ todos los usuarios y sesiones existentes. Esta acciÃ³n no se puede deshacer.
            </p>
          </div>
        </div>
      </div>

      <div class="space-y-4 mb-8">
        <div class="border border-gray-200 rounded-lg p-4">
          <h3 class="font-semibold text-gray-900 mb-2">Se crearÃ¡n estos usuarios:</h3>
          <ul class="space-y-2 text-sm">
            <li class="flex items-center gap-2">
              <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-bold">ğŸ‘‘ ADMIN</span>
              <span class="text-gray-600">admin@kampus.com / admin123</span>
            </li>
            <li class="flex items-center gap-2">
              <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-bold">âš¡ MOD</span>
              <span class="text-gray-600">moderador@kampus.com / mod123</span>
            </li>
            <li class="flex items-center gap-2">
              <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-bold">ğŸ‘¤ USER</span>
              <span class="text-gray-600">demo@kampus.com / demo123</span>
            </li>
          </ul>
        </div>

        <div id="status" class="hidden p-4 rounded-lg"></div>
      </div>

      <div class="flex gap-4">
        <button onclick="resetUsers()" class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">
          ğŸ—‘ï¸ Resetear Usuarios
        </button>
        <a href="login_/_registro/code.html" class="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium text-center">
          â† Volver al Login
        </a>
      </div>
    </div>
  </div>

  <script>
    function resetUsers() {
      if (!confirm('Â¿EstÃ¡s seguro? Esto borrarÃ¡ todos los usuarios y sesiones.')) {
        return;
      }

      const statusDiv = document.getElementById('status');
      statusDiv.classList.remove('hidden');
      statusDiv.className = 'p-4 rounded-lg bg-blue-50 border border-blue-200';
      statusDiv.innerHTML = '<p class="text-blue-800">â³ Reseteando usuarios...</p>';

      // Cerrar sesiÃ³n actual
      if (window.SessionManager) {
        window.SessionManager.logout();
      }

      // Borrar todos los datos
      localStorage.removeItem('kampus_users');
      localStorage.removeItem('kampus_current_session_id');
      
      // Borrar todas las sesiones
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('kampus_session_')) {
          localStorage.removeItem(key);
        }
      });

      setTimeout(() => {
        // Crear nuevos usuarios
        try {
          const admin = window.SessionManager.register({
            name: 'Admin Kampus',
            email: 'admin@kampus.com',
            password: 'admin123',
            university: 'Universidad de Chile',
            career: 'AdministraciÃ³n de Sistemas',
            role: 'admin',
            isAdmin: true,
            isPremium: true
          });

          const mod = window.SessionManager.register({
            name: 'Moderador Kampus',
            email: 'moderador@kampus.com',
            password: 'mod123',
            university: 'Universidad de Chile',
            career: 'ModeraciÃ³n de Contenidos',
            role: 'moderator',
            isPremium: true
          });

          const user = window.SessionManager.register({
            name: 'Usuario Demo',
            email: 'demo@kampus.com',
            password: 'demo123',
            university: 'Universidad de Chile',
            career: 'IngenierÃ­a Civil',
            role: 'user',
            isPremium: false
          });

          statusDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200';
          statusDiv.innerHTML = `
            <p class="text-green-800 font-semibold mb-2">âœ… Usuarios reseteados exitosamente!</p>
            <ul class="text-sm text-green-700 space-y-1">
              <li>ğŸ‘‘ Admin: ${admin.success ? 'âœ…' : 'âŒ ' + admin.error}</li>
              <li>âš¡ Moderador: ${mod.success ? 'âœ…' : 'âŒ ' + mod.error}</li>
              <li>ğŸ‘¤ Usuario: ${user.success ? 'âœ…' : 'âŒ ' + user.error}</li>
            </ul>
            <p class="text-green-700 text-sm mt-3">Redirigiendo al login...</p>
          `;

          console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
          console.log('âœ… USUARIOS RESETEADOS EXITOSAMENTE');
          console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
          console.log('Admin:', admin);
          console.log('Mod:', mod);
          console.log('User:', user);
          console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

          setTimeout(() => {
            window.location.href = 'login_/_registro/code.html';
          }, 2000);

        } catch (error) {
          statusDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200';
          statusDiv.innerHTML = `
            <p class="text-red-800 font-semibold">âŒ Error al crear usuarios</p>
            <p class="text-sm text-red-700 mt-1">${error.message}</p>
          `;
          console.error('Error:', error);
        }
      }, 500);
    }

    // Verificar estado actual al cargar
    window.addEventListener('load', () => {
      if (window.SessionManager) {
        const users = window.SessionManager.getAllUsers();
        console.log('Usuarios actuales:', users);
        console.log('Total de usuarios:', users.length);
        
        if (users.length > 0) {
          console.log('Primer usuario tiene roles?', users[0].hasOwnProperty('role'));
        }
      }
    });
  </script>

</body>
</html>
